using LinearAlgebra
using BenchmarkTools
using Test
using Plots

function Rpp(θ, ρ₁, ρ₂, α₁, α₂, β₂)
    x = sin(θ)
    if x > α₁ / α₂
        return 1.0
    end
    a = α₂ / α₁
    b = β₂ / α₂
    r = ρ₂ / ρ₁
    f(j, x) = sqrt(1 - (j * x)^2)
    g(j, x) = 1 - 2 * (j * x)^2
    M = [
        f(1, x) f(a, x) -b * x
        0 2 * b * x * f(a, x) g(b, x)
        -1 r * a * g(b, x) -2 * r * b^2 * x * f(b, x)
    ]
    B = [f(1, x); 0; 1]
    MP = [B M[:, 2:3]]
    det(MP) / det(M)
end

function Rpp2(θ, ρ₁, ρ₂, α₁, α₂, β₂)
    x = sin(θ)
    if x > α₁ / α₂
        return 1.0
    end
    a = α₂ / α₁
    b = β₂ / α₂
    r = ρ₂ / ρ₁
    f(j, x) = sqrt(1 - (j * x)^2)
    g(j, x) = 1 - 2 * (j * x)^2
    nom = -a * f(1, x) * g(b, x)^2 * r -
          4 * b^3 * f(1, x) * f(a, x) * f(b, x) * r * x^2 +
          2 * b^2 * f(a, x) * x^2 + f(a, x) * g(b, x)
    den = -a * f(1, x) * g(b, x)^2 * r -
          4 * b^3 * f(1, x) * f(a, x) * f(b, x) * r * x^2 -
          2 * b^2 * f(a, x) * x^2 - f(a, x) * g(b, x)
    nom / den
end

function Rpp3(θ, ρ₁, ρ₂, α₁, α₂, β₂)
    x = sin(θ)
    if x > α₁ / α₂
        return 1.0
    end
    a = α₂ / α₁
    b = β₂ / α₂
    r = ρ₂ / ρ₁
    f(j, x) = sqrt(1 - (j * x)^2)
    g(j, x) = 1 - 2 * (j * x)^2
    c = -a * f(1, x) * g(b, x)^2 * r -
        4 * b^3 * f(1, x) * f(a, x) * f(b, x) * r * x^2
    d = 2 * b^2 * f(a, x) * x^2 + f(a, x) * g(b, x)
    (c + d) / (c - d)
end

p = collect(range(0, 1/1500.0, length=1000))
θ = asin.(1500.0*p)
println("benchmark")
@btime r = Rpp.(θ, 1000.0, 2000.0, 1500.0, 2000.0, 500.0)
@btime r2 = Rpp2.(θ, 1000.0, 2000.0, 1500.0, 2000.0, 500.0)
@btime r3 = Rpp3.(θ, 1000.0, 2000.0, 1500.0, 2000.0, 500.0)

r = Rpp.(θ, 1000.0, 2000.0, 1500.0, 2000.0, 500.0)
r2 = Rpp2.(θ, 1000.0, 2000.0, 1500.0, 2000.0, 500.0)
r3 = Rpp3.(θ, 1000.0, 2000.0, 1500.0, 2000.0, 500.0)

@test isapprox(r, r2)
@test isapprox(r, r3)
@test isapprox(r[1], 0.4545454545454546)

rpy = [ 0.4545,  0.4545,  0.4545,  0.4545,  0.4545,  0.4545,  0.4545,
        0.4545,  0.4545,  0.4545,  0.4545,  0.4545,  0.4545,  0.4545,
        0.4545,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4546,
        0.4546,  0.4546,  0.4546,  0.4546,  0.4546,  0.4547,  0.4547,
        0.4547,  0.4547,  0.4547,  0.4547,  0.4547,  0.4547,  0.4547,
        0.4547,  0.4547,  0.4547,  0.4547,  0.4547,  0.4547,  0.4547,
        0.4547,  0.4547,  0.4547,  0.4547,  0.4547,  0.4547,  0.4547,
        0.4547,  0.4547,  0.4547,  0.4548,  0.4548,  0.4548,  0.4548,
        0.4548,  0.4548,  0.4548,  0.4548,  0.4548,  0.4548,  0.4548,
        0.4548,  0.4548,  0.4548,  0.4548,  0.4548,  0.4548,  0.4548,
        0.4548,  0.4549,  0.4549,  0.4549,  0.4549,  0.4549,  0.4549,
        0.4549,  0.4549,  0.4549,  0.4549,  0.4549,  0.4549,  0.4549,
        0.4549,  0.4549,  0.4550,  0.4550,  0.4550,  0.4550,  0.4550,
        0.4550,  0.4550,  0.4550,  0.4550,  0.4550,  0.4550,  0.4550,
        0.4550,  0.4551,  0.4551,  0.4551,  0.4551,  0.4551,  0.4551,
        0.4551,  0.4551,  0.4551,  0.4551,  0.4551,  0.4552,  0.4552,
        0.4552,  0.4552,  0.4552,  0.4552,  0.4552,  0.4552,  0.4552,
        0.4552,  0.4552,  0.4553,  0.4553,  0.4553,  0.4553,  0.4553,
        0.4553,  0.4553,  0.4553,  0.4553,  0.4554,  0.4554,  0.4554,
        0.4554,  0.4554,  0.4554,  0.4554,  0.4554,  0.4554,  0.4555,
        0.4555,  0.4555,  0.4555,  0.4555,  0.4555,  0.4555,  0.4556,
        0.4556,  0.4556,  0.4556,  0.4556,  0.4556,  0.4556,  0.4556,
        0.4557,  0.4557,  0.4557,  0.4557,  0.4557,  0.4557,  0.4558,
        0.4558,  0.4558,  0.4558,  0.4558,  0.4558,  0.4558,  0.4559,
        0.4559,  0.4559,  0.4559,  0.4559,  0.4559,  0.4560,  0.4560,
        0.4560,  0.4560,  0.4560,  0.4560,  0.4561,  0.4561,  0.4561,
        0.4561,  0.4561,  0.4562,  0.4562,  0.4562,  0.4562,  0.4562,
        0.4563,  0.4563,  0.4563,  0.4563,  0.4563,  0.4564,  0.4564,
        0.4564,  0.4564,  0.4564,  0.4565,  0.4565,  0.4565,  0.4565,
        0.4566,  0.4566,  0.4566,  0.4566,  0.4566,  0.4567,  0.4567,
        0.4567,  0.4567,  0.4568,  0.4568,  0.4568,  0.4568,  0.4569,
        0.4569,  0.4569,  0.4569,  0.4570,  0.4570,  0.4570,  0.4570,
        0.4571,  0.4571,  0.4571,  0.4572,  0.4572,  0.4572,  0.4572,
        0.4573,  0.4573,  0.4573,  0.4574,  0.4574,  0.4574,  0.4574,
        0.4575,  0.4575,  0.4575,  0.4576,  0.4576,  0.4576,  0.4577,
        0.4577,  0.4577,  0.4578,  0.4578,  0.4578,  0.4579,  0.4579,
        0.4579,  0.4580,  0.4580,  0.4580,  0.4581,  0.4581,  0.4581,
        0.4582,  0.4582,  0.4583,  0.4583,  0.4583,  0.4584,  0.4584,
        0.4584,  0.4585,  0.4585,  0.4586,  0.4586,  0.4586,  0.4587,
        0.4587,  0.4588,  0.4588,  0.4589,  0.4589,  0.4589,  0.4590,
        0.4590,  0.4591,  0.4591,  0.4592,  0.4592,  0.4593,  0.4593,
        0.4593,  0.4594,  0.4594,  0.4595,  0.4595,  0.4596,  0.4596,
        0.4597,  0.4597,  0.4598,  0.4598,  0.4599,  0.4599,  0.4600,
        0.4600,  0.4601,  0.4602,  0.4602,  0.4603,  0.4603,  0.4604,
        0.4604,  0.4605,  0.4605,  0.4606,  0.4607,  0.4607,  0.4608,
        0.4608,  0.4609,  0.4610,  0.4610,  0.4611,  0.4611,  0.4612,
        0.4613,  0.4613,  0.4614,  0.4615,  0.4615,  0.4616,  0.4616,
        0.4617,  0.4618,  0.4618,  0.4619,  0.4620,  0.4621,  0.4621,
        0.4622,  0.4623,  0.4623,  0.4624,  0.4625,  0.4626,  0.4626,
        0.4627,  0.4628,  0.4629,  0.4629,  0.4630,  0.4631,  0.4632,
        0.4633,  0.4633,  0.4634,  0.4635,  0.4636,  0.4637,  0.4637,
        0.4638,  0.4639,  0.4640,  0.4641,  0.4642,  0.4643,  0.4644,
        0.4644,  0.4645,  0.4646,  0.4647,  0.4648,  0.4649,  0.4650,
        0.4651,  0.4652,  0.4653,  0.4654,  0.4655,  0.4656,  0.4657,
        0.4658,  0.4659,  0.4660,  0.4661,  0.4662,  0.4663,  0.4664,
        0.4665,  0.4666,  0.4667,  0.4668,  0.4670,  0.4671,  0.4672,
        0.4673,  0.4674,  0.4675,  0.4676,  0.4678,  0.4679,  0.4680,
        0.4681,  0.4682,  0.4684,  0.4685,  0.4686,  0.4687,  0.4689,
        0.4690,  0.4691,  0.4693,  0.4694,  0.4695,  0.4697,  0.4698,
        0.4699,  0.4701,  0.4702,  0.4703,  0.4705,  0.4706,  0.4708,
        0.4709,  0.4711,  0.4712,  0.4714,  0.4715,  0.4717,  0.4718,
        0.4720,  0.4721,  0.4723,  0.4724,  0.4726,  0.4728,  0.4729,
        0.4731,  0.4732,  0.4734,  0.4736,  0.4738,  0.4739,  0.4741,
        0.4743,  0.4744,  0.4746,  0.4748,  0.4750,  0.4752,  0.4754,
        0.4755,  0.4757,  0.4759,  0.4761,  0.4763,  0.4765,  0.4767,
        0.4769,  0.4771,  0.4773,  0.4775,  0.4777,  0.4779,  0.4781,
        0.4783,  0.4785,  0.4787,  0.4790,  0.4792,  0.4794,  0.4796,
        0.4799,  0.4801,  0.4803,  0.4805,  0.4808,  0.4810,  0.4812,
        0.4815,  0.4817,  0.4820,  0.4822,  0.4825,  0.4827,  0.4830,
        0.4832,  0.4835,  0.4837,  0.4840,  0.4843,  0.4845,  0.4848,
        0.4851,  0.4854,  0.4856,  0.4859,  0.4862,  0.4865,  0.4868,
        0.4871,  0.4874,  0.4877,  0.4880,  0.4883,  0.4886,  0.4889,
        0.4892,  0.4895,  0.4898,  0.4901,  0.4905,  0.4908,  0.4911,
        0.4915,  0.4918,  0.4921,  0.4925,  0.4928,  0.4932,  0.4935,
        0.4939,  0.4943,  0.4946,  0.4950,  0.4954,  0.4957,  0.4961,
        0.4965,  0.4969,  0.4973,  0.4977,  0.4981,  0.4985,  0.4989,
        0.4993,  0.4997,  0.5001,  0.5006,  0.5010,  0.5014,  0.5019,
        0.5023,  0.5028,  0.5032,  0.5037,  0.5041,  0.5046,  0.5051,
        0.5055,  0.5060,  0.5065,  0.5070,  0.5075,  0.5080,  0.5085,
        0.5090,  0.5096,  0.5101,  0.5106,  0.5111,  0.5117,  0.5122,
        0.5128,  0.5134,  0.5139,  0.5145,  0.5151,  0.5157,  0.5163,
        0.5169,  0.5175,  0.5181,  0.5187,  0.5193,  0.5200,  0.5206,
        0.5213,  0.5219,  0.5226,  0.5233,  0.5240,  0.5247,  0.5254,
        0.5261,  0.5268,  0.5275,  0.5282,  0.5290,  0.5297,  0.5305,
        0.5313,  0.5321,  0.5328,  0.5336,  0.5345,  0.5353,  0.5361,
        0.5370,  0.5378,  0.5387,  0.5395,  0.5404,  0.5413,  0.5422,
        0.5432,  0.5441,  0.5451,  0.5460,  0.5470,  0.5480,  0.5490,
        0.5500,  0.5510,  0.5521,  0.5531,  0.5542,  0.5553,  0.5564,
        0.5575,  0.5586,  0.5598,  0.5610,  0.5621,  0.5633,  0.5646,
        0.5658,  0.5671,  0.5683,  0.5696,  0.5710,  0.5723,  0.5737,
        0.5750,  0.5764,  0.5779,  0.5793,  0.5808,  0.5823,  0.5838,
        0.5854,  0.5869,  0.5885,  0.5902,  0.5918,  0.5935,  0.5952,
        0.5970,  0.5987,  0.6005,  0.6024,  0.6043,  0.6062,  0.6081,
        0.6101,  0.6121,  0.6142,  0.6163,  0.6185,  0.6206,  0.6229,
        0.6252,  0.6275,  0.6299,  0.6323,  0.6348,  0.6374,  0.6400,
        0.6426,  0.6454,  0.6482,  0.6510,  0.6539,  0.6570,  0.6600,
        0.6632,  0.6664,  0.6698,  0.6732,  0.6767,  0.6804,  0.6841,
        0.6880,  0.6919,  0.6960,  0.7003,  0.7047,  0.7092,  0.7139,
        0.7188,  0.7238,  0.7291,  0.7346,  0.7403,  0.7463,  0.7526,
        0.7592,  0.7662,  0.7735,  0.7813,  0.7896,  0.7984,  0.8080,
        0.8184,  0.8297,  0.8423,  0.8565,  0.8729,  0.8927,  0.9186,
        0.9626,  0.9976,  0.9943,  0.9910,  0.9877,  0.9843,  0.9809,
        0.9775,  0.9741,  0.9707,  0.9672,  0.9637,  0.9601,  0.9566,
        0.9530,  0.9494,  0.9457,  0.9421,  0.9384,  0.9346,  0.9309,
        0.9271,  0.9233,  0.9194,  0.9156,  0.9117,  0.9077,  0.9038,
        0.8998,  0.8958,  0.8917,  0.8877,  0.8836,  0.8794,  0.8753,
        0.8711,  0.8668,  0.8626,  0.8583,  0.8540,  0.8496,  0.8452,
        0.8408,  0.8364,  0.8319,  0.8274,  0.8229,  0.8183,  0.8137,
        0.8090,  0.8044,  0.7997,  0.7949,  0.7902,  0.7854,  0.7805,
        0.7757,  0.7708,  0.7658,  0.7609,  0.7559,  0.7508,  0.7458,
        0.7407,  0.7355,  0.7303,  0.7251,  0.7199,  0.7146,  0.7093,
        0.7040,  0.6986,  0.6932,  0.6877,  0.6822,  0.6767,  0.6711,
        0.6655,  0.6599,  0.6542,  0.6485,  0.6428,  0.6370,  0.6312,
        0.6254,  0.6195,  0.6135,  0.6076,  0.6016,  0.5955,  0.5895,
        0.5834,  0.5772,  0.5710,  0.5648,  0.5585,  0.5523,  0.5459,
        0.5395,  0.5331,  0.5267,  0.5202,  0.5137,  0.5071,  0.5005,
        0.4939,  0.4872,  0.4805,  0.4737,  0.4669,  0.4601,  0.4532,
        0.4463,  0.4393,  0.4323,  0.4253,  0.4182,  0.4111,  0.4040,
        0.3968,  0.3896,  0.3823,  0.3750,  0.3676,  0.3602,  0.3528,
        0.3454,  0.3378,  0.3303,  0.3227,  0.3151,  0.3074,  0.2997,
        0.2920,  0.2842,  0.2764,  0.2685,  0.2606,  0.2527,  0.2447,
        0.2366,  0.2286,  0.2205,  0.2123,  0.2041,  0.1959,  0.1876,
        0.1793,  0.1710,  0.1626,  0.1542,  0.1457,  0.1372,  0.1286,
        0.1200,  0.1114,  0.1027,  0.0940,  0.0852,  0.0765,  0.0676,
        0.0587,  0.0498,  0.0408,  0.0318,  0.0228,  0.0137,  0.0046,
       -0.0046, -0.0138, -0.0231, -0.0323, -0.0417, -0.0511, -0.0605,
       -0.0700, -0.0795, -0.0890, -0.0986, -0.1082, -0.1179, -0.1276,
       -0.1374, -0.1472, -0.1571, -0.1670, -0.1769, -0.1869, -0.1969,
       -0.2070, -0.2172, -0.2273, -0.2375, -0.2478, -0.2581, -0.2685,
       -0.2789, -0.2894, -0.2999, -0.3104, -0.3210, -0.3317, -0.3424,
       -0.3532, -0.3640, -0.3749, -0.3858, -0.3968, -0.4079, -0.4190,
       -0.4301, -0.4413, -0.4526, -0.4640, -0.4754, -0.4869, -0.4984,
       -0.5101, -0.5218, -0.5336, -0.5454, -0.5573, -0.5694, -0.5815,
       -0.5937, -0.6059, -0.6183, -0.6308, -0.6434, -0.6561, -0.6690,
       -0.6819, -0.6950, -0.7082, -0.7216, -0.7352, -0.7489, -0.7628,
       -0.7769, -0.7913, -0.8059, -0.8208, -0.8361, -0.8517, -0.8678,
       -0.8845, -0.9018, -0.9202, -0.9400, -0.9625, -1.0000]

ppy = [ 0.0000,  0.0007,  0.0013,  0.0020,  0.0027,  0.0033,  0.0040,
        0.0047,  0.0053,  0.0060,  0.0067,  0.0073,  0.0080,  0.0087,
        0.0093,  0.0100,  0.0107,  0.0113,  0.0120,  0.0127,  0.0133,
        0.0140,  0.0147,  0.0153,  0.0160,  0.0167,  0.0174,  0.0180,
        0.0187,  0.0194,  0.0200,  0.0207,  0.0214,  0.0220,  0.0227,
        0.0234,  0.0240,  0.0247,  0.0254,  0.0260,  0.0267,  0.0274,
        0.0280,  0.0287,  0.0294,  0.0300,  0.0307,  0.0314,  0.0320,
        0.0327,  0.0334,  0.0340,  0.0347,  0.0354,  0.0360,  0.0367,
        0.0374,  0.0380,  0.0387,  0.0394,  0.0400,  0.0407,  0.0414,
        0.0420,  0.0427,  0.0434,  0.0440,  0.0447,  0.0454,  0.0460,
        0.0467,  0.0474,  0.0480,  0.0487,  0.0494,  0.0501,  0.0507,
        0.0514,  0.0521,  0.0527,  0.0534,  0.0541,  0.0547,  0.0554,
        0.0561,  0.0567,  0.0574,  0.0581,  0.0587,  0.0594,  0.0601,
        0.0607,  0.0614,  0.0621,  0.0627,  0.0634,  0.0641,  0.0647,
        0.0654,  0.0661,  0.0667,  0.0674,  0.0681,  0.0687,  0.0694,
        0.0701,  0.0707,  0.0714,  0.0721,  0.0727,  0.0734,  0.0741,
        0.0747,  0.0754,  0.0761,  0.0767,  0.0774,  0.0781,  0.0787,
        0.0794,  0.0801,  0.0807,  0.0814,  0.0821,  0.0827,  0.0834,
        0.0841,  0.0848,  0.0854,  0.0861,  0.0868,  0.0874,  0.0881,
        0.0888,  0.0894,  0.0901,  0.0908,  0.0914,  0.0921,  0.0928,
        0.0934,  0.0941,  0.0948,  0.0954,  0.0961,  0.0968,  0.0974,
        0.0981,  0.0988,  0.0994,  0.1001,  0.1008,  0.1014,  0.1021,
        0.1028,  0.1034,  0.1041,  0.1048,  0.1054,  0.1061,  0.1068,
        0.1074,  0.1081,  0.1088,  0.1094,  0.1101,  0.1108,  0.1114,
        0.1121,  0.1128,  0.1134,  0.1141,  0.1148,  0.1154,  0.1161,
        0.1168,  0.1175,  0.1181,  0.1188,  0.1195,  0.1201,  0.1208,
        0.1215,  0.1221,  0.1228,  0.1235,  0.1241,  0.1248,  0.1255,
        0.1261,  0.1268,  0.1275,  0.1281,  0.1288,  0.1295,  0.1301,
        0.1308,  0.1315,  0.1321,  0.1328,  0.1335,  0.1341,  0.1348,
        0.1355,  0.1361,  0.1368,  0.1375,  0.1381,  0.1388,  0.1395,
        0.1401,  0.1408,  0.1415,  0.1421,  0.1428,  0.1435,  0.1441,
        0.1448,  0.1455,  0.1461,  0.1468,  0.1475,  0.1481,  0.1488,
        0.1495,  0.1502,  0.1508,  0.1515,  0.1522,  0.1528,  0.1535,
        0.1542,  0.1548,  0.1555,  0.1562,  0.1568,  0.1575,  0.1582,
        0.1588,  0.1595,  0.1602,  0.1608,  0.1615,  0.1622,  0.1628,
        0.1635,  0.1642,  0.1648,  0.1655,  0.1662,  0.1668,  0.1675,
        0.1682,  0.1688,  0.1695,  0.1702,  0.1708,  0.1715,  0.1722,
        0.1728,  0.1735,  0.1742,  0.1748,  0.1755,  0.1762,  0.1768,
        0.1775,  0.1782,  0.1788,  0.1795,  0.1802,  0.1808,  0.1815,
        0.1822,  0.1828,  0.1835,  0.1842,  0.1849,  0.1855,  0.1862,
        0.1869,  0.1875,  0.1882,  0.1889,  0.1895,  0.1902,  0.1909,
        0.1915,  0.1922,  0.1929,  0.1935,  0.1942,  0.1949,  0.1955,
        0.1962,  0.1969,  0.1975,  0.1982,  0.1989,  0.1995,  0.2002,
        0.2009,  0.2015,  0.2022,  0.2029,  0.2035,  0.2042,  0.2049,
        0.2055,  0.2062,  0.2069,  0.2075,  0.2082,  0.2089,  0.2095,
        0.2102,  0.2109,  0.2115,  0.2122,  0.2129,  0.2135,  0.2142,
        0.2149,  0.2155,  0.2162,  0.2169,  0.2176,  0.2182,  0.2189,
        0.2196,  0.2202,  0.2209,  0.2216,  0.2222,  0.2229,  0.2236,
        0.2242,  0.2249,  0.2256,  0.2262,  0.2269,  0.2276,  0.2282,
        0.2289,  0.2296,  0.2302,  0.2309,  0.2316,  0.2322,  0.2329,
        0.2336,  0.2342,  0.2349,  0.2356,  0.2362,  0.2369,  0.2376,
        0.2382,  0.2389,  0.2396,  0.2402,  0.2409,  0.2416,  0.2422,
        0.2429,  0.2436,  0.2442,  0.2449,  0.2456,  0.2462,  0.2469,
        0.2476,  0.2482,  0.2489,  0.2496,  0.2503,  0.2509,  0.2516,
        0.2523,  0.2529,  0.2536,  0.2543,  0.2549,  0.2556,  0.2563,
        0.2569,  0.2576,  0.2583,  0.2589,  0.2596,  0.2603,  0.2609,
        0.2616,  0.2623,  0.2629,  0.2636,  0.2643,  0.2649,  0.2656,
        0.2663,  0.2669,  0.2676,  0.2683,  0.2689,  0.2696,  0.2703,
        0.2709,  0.2716,  0.2723,  0.2729,  0.2736,  0.2743,  0.2749,
        0.2756,  0.2763,  0.2769,  0.2776,  0.2783,  0.2789,  0.2796,
        0.2803,  0.2809,  0.2816,  0.2823,  0.2829,  0.2836,  0.2843,
        0.2850,  0.2856,  0.2863,  0.2870,  0.2876,  0.2883,  0.2890,
        0.2896,  0.2903,  0.2910,  0.2916,  0.2923,  0.2930,  0.2936,
        0.2943,  0.2950,  0.2956,  0.2963,  0.2970,  0.2976,  0.2983,
        0.2990,  0.2996,  0.3003,  0.3010,  0.3016,  0.3023,  0.3030,
        0.3036,  0.3043,  0.3050,  0.3056,  0.3063,  0.3070,  0.3076,
        0.3083,  0.3090,  0.3096,  0.3103,  0.3110,  0.3116,  0.3123,
        0.3130,  0.3136,  0.3143,  0.3150,  0.3156,  0.3163,  0.3170,
        0.3177,  0.3183,  0.3190,  0.3197,  0.3203,  0.3210,  0.3217,
        0.3223,  0.3230,  0.3237,  0.3243,  0.3250,  0.3257,  0.3263,
        0.3270,  0.3277,  0.3283,  0.3290,  0.3297,  0.3303,  0.3310,
        0.3317,  0.3323,  0.3330,  0.3337,  0.3343,  0.3350,  0.3357,
        0.3363,  0.3370,  0.3377,  0.3383,  0.3390,  0.3397,  0.3403,
        0.3410,  0.3417,  0.3423,  0.3430,  0.3437,  0.3443,  0.3450,
        0.3457,  0.3463,  0.3470,  0.3477,  0.3483,  0.3490,  0.3497,
        0.3504,  0.3510,  0.3517,  0.3524,  0.3530,  0.3537,  0.3544,
        0.3550,  0.3557,  0.3564,  0.3570,  0.3577,  0.3584,  0.3590,
        0.3597,  0.3604,  0.3610,  0.3617,  0.3624,  0.3630,  0.3637,
        0.3644,  0.3650,  0.3657,  0.3664,  0.3670,  0.3677,  0.3684,
        0.3690,  0.3697,  0.3704,  0.3710,  0.3717,  0.3724,  0.3730,
        0.3737,  0.3744,  0.3750,  0.3757,  0.3764,  0.3770,  0.3777,
        0.3784,  0.3790,  0.3797,  0.3804,  0.3810,  0.3817,  0.3824,
        0.3830,  0.3837,  0.3844,  0.3851,  0.3857,  0.3864,  0.3871,
        0.3877,  0.3884,  0.3891,  0.3897,  0.3904,  0.3911,  0.3917,
        0.3924,  0.3931,  0.3937,  0.3944,  0.3951,  0.3957,  0.3964,
        0.3971,  0.3977,  0.3984,  0.3991,  0.3997,  0.4004,  0.4011,
        0.4017,  0.4024,  0.4031,  0.4037,  0.4044,  0.4051,  0.4057,
        0.4064,  0.4071,  0.4077,  0.4084,  0.4091,  0.4097,  0.4104,
        0.4111,  0.4117,  0.4124,  0.4131,  0.4137,  0.4144,  0.4151,
        0.4157,  0.4164,  0.4171,  0.4178,  0.4184,  0.4191,  0.4198,
        0.4204,  0.4211,  0.4218,  0.4224,  0.4231,  0.4238,  0.4244,
        0.4251,  0.4258,  0.4264,  0.4271,  0.4278,  0.4284,  0.4291,
        0.4298,  0.4304,  0.4311,  0.4318,  0.4324,  0.4331,  0.4338,
        0.4344,  0.4351,  0.4358,  0.4364,  0.4371,  0.4378,  0.4384,
        0.4391,  0.4398,  0.4404,  0.4411,  0.4418,  0.4424,  0.4431,
        0.4438,  0.4444,  0.4451,  0.4458,  0.4464,  0.4471,  0.4478,
        0.4484,  0.4491,  0.4498,  0.4505,  0.4511,  0.4518,  0.4525,
        0.4531,  0.4538,  0.4545,  0.4551,  0.4558,  0.4565,  0.4571,
        0.4578,  0.4585,  0.4591,  0.4598,  0.4605,  0.4611,  0.4618,
        0.4625,  0.4631,  0.4638,  0.4645,  0.4651,  0.4658,  0.4665,
        0.4671,  0.4678,  0.4685,  0.4691,  0.4698,  0.4705,  0.4711,
        0.4718,  0.4725,  0.4731,  0.4738,  0.4745,  0.4751,  0.4758,
        0.4765,  0.4771,  0.4778,  0.4785,  0.4791,  0.4798,  0.4805,
        0.4811,  0.4818,  0.4825,  0.4831,  0.4838,  0.4845,  0.4852,
        0.4858,  0.4865,  0.4872,  0.4878,  0.4885,  0.4892,  0.4898,
        0.4905,  0.4912,  0.4918,  0.4925,  0.4932,  0.4938,  0.4945,
        0.4952,  0.4958,  0.4965,  0.4972,  0.4978,  0.4985,  0.4992,
        0.4998,  0.5005,  0.5012,  0.5018,  0.5025,  0.5032,  0.5038,
        0.5045,  0.5052,  0.5058,  0.5065,  0.5072,  0.5078,  0.5085,
        0.5092,  0.5098,  0.5105,  0.5112,  0.5118,  0.5125,  0.5132,
        0.5138,  0.5145,  0.5152,  0.5158,  0.5165,  0.5172,  0.5179,
        0.5185,  0.5192,  0.5199,  0.5205,  0.5212,  0.5219,  0.5225,
        0.5232,  0.5239,  0.5245,  0.5252,  0.5259,  0.5265,  0.5272,
        0.5279,  0.5285,  0.5292,  0.5299,  0.5305,  0.5312,  0.5319,
        0.5325,  0.5332,  0.5339,  0.5345,  0.5352,  0.5359,  0.5365,
        0.5372,  0.5379,  0.5385,  0.5392,  0.5399,  0.5405,  0.5412,
        0.5419,  0.5425,  0.5432,  0.5439,  0.5445,  0.5452,  0.5459,
        0.5465,  0.5472,  0.5479,  0.5485,  0.5492,  0.5499,  0.5506,
        0.5512,  0.5519,  0.5526,  0.5532,  0.5539,  0.5546,  0.5552,
        0.5559,  0.5566,  0.5572,  0.5579,  0.5586,  0.5592,  0.5599,
        0.5606,  0.5612,  0.5619,  0.5626,  0.5632,  0.5639,  0.5646,
        0.5652,  0.5659,  0.5666,  0.5672,  0.5679,  0.5686,  0.5692,
        0.5699,  0.5706,  0.5712,  0.5719,  0.5726,  0.5732,  0.5739,
        0.5746,  0.5752,  0.5759,  0.5766,  0.5772,  0.5779,  0.5786,
        0.5792,  0.5799,  0.5806,  0.5812,  0.5819,  0.5826,  0.5832,
        0.5839,  0.5846,  0.5853,  0.5859,  0.5866,  0.5873,  0.5879,
        0.5886,  0.5893,  0.5899,  0.5906,  0.5913,  0.5919,  0.5926,
        0.5933,  0.5939,  0.5946,  0.5953,  0.5959,  0.5966,  0.5973,
        0.5979,  0.5986,  0.5993,  0.5999,  0.6006,  0.6013,  0.6019,
        0.6026,  0.6033,  0.6039,  0.6046,  0.6053,  0.6059,  0.6066,
        0.6073,  0.6079,  0.6086,  0.6093,  0.6099,  0.6106,  0.6113,
        0.6119,  0.6126,  0.6133,  0.6139,  0.6146,  0.6153,  0.6159,
        0.6166,  0.6173,  0.6180,  0.6186,  0.6193,  0.6200,  0.6206,
        0.6213,  0.6220,  0.6226,  0.6233,  0.6240,  0.6246,  0.6253,
        0.6260,  0.6266,  0.6273,  0.6280,  0.6286,  0.6293,  0.6300,
        0.6306,  0.6313,  0.6320,  0.6326,  0.6333,  0.6340,  0.6346,
        0.6353,  0.6360,  0.6366,  0.6373,  0.6380,  0.6386,  0.6393,
        0.6400,  0.6406,  0.6413,  0.6420,  0.6426,  0.6433,  0.6440,
        0.6446,  0.6453,  0.6460,  0.6466,  0.6473,  0.6480,  0.6486,
        0.6493,  0.6500,  0.6507,  0.6513,  0.6520,  0.6527,  0.6533,
        0.6540,  0.6547,  0.6553,  0.6560,  0.6567,  0.6573,  0.6580,
        0.6587,  0.6593,  0.6600,  0.6607,  0.6613,  0.6620,  0.6627,
        0.6633,  0.6640,  0.6647,  0.6653,  0.6660,  0.6667]

plot(p, r, ylim=[-2,2])
plot!(ppy/1000, rpy, ylim=[-2,2])
